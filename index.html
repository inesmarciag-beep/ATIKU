<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Atiku - Prototipo Simulador Aeroespacial</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .hidden { display: none !important; }
    .progress-bar {
      height: 6px;
      background-color: rgb(250 204 21);
      border-radius: 9999px;
      width: 0%;
      transition: width 0.3s ease-in-out;
    }
  </style>
</head>
<body class="bg-black text-white min-h-screen p-6">
  <header class="mb-4 p-4 bg-gray-900 shadow-xl rounded-2xl border-t-4 border-purple-600">
    <h1 class="text-3xl font-extrabold text-amber-400 flex items-center gap-3">
      🚀 Plataforma ATIKU — Prototipo
      <span class="text-sm text-gray-400 font-normal ml-2">Módulos Aeroespaciales · Delta Coins</span>
    </h1>
    <p class="text-sm text-gray-400 mt-1">Gana Delta Coins, descarga módulos y recibe retroalimentación de tu capitán.</p>
  </header>

  <!-- BANNER DE RETROALIMENTACIÓN (aparece después de completar misión) -->
  <div id="feedbackBanner" class="hidden mb-4 p-4 rounded-xl border-l-4 border-amber-400 bg-amber-900/10 text-amber-300 flex items-center justify-between shadow-inner">
    <div class="flex items-center gap-3">
      <div class="text-xl">📡</div>
      <div>
        <div class="text-sm font-semibold">Enviada</div>
        <div class="text-sm opacity-90">Esperando retroalimentación de tu capitán...</div>
      </div>
    </div>
    <div class="flex items-center gap-3">
      <button id="dismissFeedback" class="py-1 px-3 rounded-md bg-gray-800 text-gray-200 hover:bg-gray-700">Cerrar</button>
    </div>
  </div>

  <!-- Indicador de fase -->
  <div id="phase" class="p-4 rounded-xl shadow-lg border-2 border-gray-700 flex items-center justify-between bg-gray-600 text-white mb-6">
    <div>
      <div class="text-xs uppercase opacity-80">Fase Actual del Proyecto</div>
      <div id="phaseName" class="text-xl font-bold">Fase de Ensamblaje</div>
    </div>
    <div class="text-3xl font-extrabold flex items-center">
      <span id="coinCount">1500</span> <span class="ml-2">💫</span>
    </div>
  </div>

  <!-- Consola de mensajes -->
  <div id="console" class="hidden p-3 mb-6 rounded-lg text-sm bg-amber-900/20 text-amber-200 border-l-4 border-amber-500 shadow-inner"></div>

  <!-- Módulos -->
  <section class="bg-gray-900 rounded-xl shadow-2xl min-h-[320px] p-6">
    <h2 class="text-2xl font-bold text-white mb-4">📘 Bloques de Aprendizaje Introductorio</h2>
    <div id="modules" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
  </section>

  <script>
    /* ---------- Configuración ---------- */
    const PHASES = [
      { name: 'Fase de Ensamblaje', required_coins: 0, color: 'bg-gray-600' },
      { name: 'Fase de Despegue', required_coins: 2000, color: 'bg-purple-600' },
      { name: 'Fase Orbital', required_coins: 5000, color: 'bg-amber-400' },
      { name: 'Fase Interplanetaria', required_coins: 10000, color: 'bg-pink-500' },
    ];

    const MODULES = [
      { id: 1, title: 'Introducción a Cohetes', description: '¿Cómo funcionan los cohetes? Partes principales y el principio de acción y reacción.', coin_reward: 500, video: 'https://www.youtube.com/watch?v=2b1KxXDFz0I' },
      { id: 2, title: 'Órbitas y Gravedad', description: 'Conceptos de gravedad, microgravedad y los diferentes tipos de órbitas (LEO, GEO).', coin_reward: 750, video: 'https://www.youtube.com/watch?v=wN2kK9Odr2Y' },
      { id: 3, title: '¿Qué es la Telemetría?', description: 'Conceptos básicos de la transmisión de datos por satélite y la importancia del ahorro de energía.', coin_reward: 1000, video: 'https://www.youtube.com/watch?v=QU5U0dQGztA' },
    ];

    /* ---------- Estado ---------- */
    let coins = 1500;
    let missionsCompleted = {};
    let module1Downloaded = false;
    let isDownloading = false;

    /* ---------- Elementos ---------- */
    const consoleEl = document.getElementById('console');
    const modulesEl = document.getElementById('modules');
    const phaseName = document.getElementById('phaseName');
    const coinCount = document.getElementById('coinCount');
    const phaseBox = document.getElementById('phase');

    const feedbackBanner = document.getElementById('feedbackBanner');
    const dismissFeedbackBtn = document.getElementById('dismissFeedback');

    dismissFeedbackBtn.addEventListener('click', () => {
      feedbackBanner.classList.add('hidden');
    });

    /* ---------- Helpers ---------- */
    function getCurrentPhase(coins) {
      for (let i = PHASES.length - 1; i >= 0; i--) {
        if (coins >= PHASES[i].required_coins) return PHASES[i];
      }
      return PHASES[0];
    }

    function showConsoleMessage(msg, timeout = 4000) {
      consoleEl.textContent = msg;
      consoleEl.classList.remove('hidden');
      if (timeout > 0) {
        clearTimeout(consoleEl._hideTimeout);
        consoleEl._hideTimeout = setTimeout(() => consoleEl.classList.add('hidden'), timeout);
      }
    }

    function showFeedbackBanner(message = 'Enviada: esperando retroalimentación de tu capitán...') {
      feedbackBanner.querySelector('div > div > .text-sm')?.remove?.(); // safe no-op
      // Set content (keeps structure)
      feedbackBanner.querySelector('div > div > .text-sm')?.textContent = message;
      // Simpler approach: just ensure banner visible and text replaced:
      feedbackBanner.querySelectorAll('div > div')[1].children[0].textContent = 'Enviada';
      feedbackBanner.querySelectorAll('div > div')[1].children[1].textContent = 'Esperando retroalimentación de tu capitán...';
      feedbackBanner.classList.remove('hidden');
    }

    function updatePhase() {
      const phase = getCurrentPhase(coins);
      phaseName.textContent = phase.name;
      coinCount.textContent = coins;
      phaseBox.className = `p-4 rounded-xl shadow-lg border-2 border-gray-700 flex items-center justify-between ${phase.color} text-white mb-6`;
    }

    /* ---------- Lógica: Descargar Módulo 1 ---------- */
    function startDownload(button) {
      if (isDownloading) return;
      isDownloading = true;
      button.disabled = true;
      showConsoleMessage('🚀 Protocolo Store-and-Forward activado. Recibiendo paquete (25 MB)...', 2500);

      const progressBar = button.nextElementSibling.querySelector('.progress-bar');
      let progress = 0;
      const interval = setInterval(() => {
        progress += Math.random() * 15; // ráfagas
        if (progress >= 100) {
          progress = 100;
          clearInterval(interval);
          module1Downloaded = true;
          isDownloading = false;
          showConsoleMessage('✅ ¡Transmisión exitosa! Módulo desbloqueado para estudio OFFLINE.', 3500);
          renderModules();
        }
        progressBar.style.width = progress + '%';
      }, 350);
    }

    /* ---------- Lógica: Completar desafío (misión) ---------- */
    function completeMission(id, reward) {
      if (missionsCompleted[id]) return;
      missionsCompleted[id] = true;
      coins += reward;
      // Mensaje instantáneo
      showConsoleMessage(`✅ ¡Desafío superado! Ganas +${reward} Delta Coins.`, 2200);
      updatePhase();
      renderModules();

      // Simula envío de telemetría y muestra banner "Enviada: esperando retroalimentación..."
      setTimeout(() => {
        showConsoleMessage(`📡 Enviando telemetría...`, 1400);
      }, 600);

      setTimeout(() => {
        showFeedbackBanner();
      }, 1500);
    }

    /* ---------- Render de módulos ---------- */
    function renderModules() {
      modulesEl.innerHTML = '';
      MODULES.forEach(module => {
        const locked = module.id > 1 && coins < PHASES[1].required_coins;
        const completed = missionsCompleted[module.id];
        const card = document.createElement('div');
        card.className = `p-5 rounded-xl shadow-lg border transition duration-300 transform hover:scale-[1.02] ${completed ? 'bg-purple-800/50 border-purple-500' : 'bg-gray-800 border-gray-700'}`;

        let actionsHTML = '';

        if (completed) {
          actionsHTML = `<button class="w-full py-2 px-4 rounded-lg bg-green-600 text-white font-bold flex items-center justify-center">✔ Misión Cumplida</button>`;
        } else if (locked) {
          actionsHTML = `<button class="w-full py-2 px-4 rounded-lg bg-gray-600 text-gray-300 font-bold">🔒 Bloqueado (Req. Despegue: ${PHASES[1].required_coins} Coins)</button>`;
        } else if (module.id === 1 && !module1Downloaded) {
          actionsHTML = `
            <button onclick="startDownload(this)" class="w-full py-2 px-4 rounded-lg bg-amber-400 text-black font-bold hover:bg-amber-300">📡 Descargar Módulo (25MB)</button>
            <div class="mt-3 bg-gray-700 rounded-full"><div class="progress-bar"></div></div>
          `;
        } else {
          actionsHTML = `
            <div class="flex gap-3">
              <a href="${module.video}" target="_blank" rel="noopener" class="flex-1 py-2 px-4 rounded-lg bg-purple-700 text-white font-bold text-center hover:bg-purple-600">🎥 Ver Video</a>
              <button onclick="completeMission(${module.id}, ${module.coin_reward})" class="flex-1 py-2 px-4 rounded-lg bg-amber-400 text-black font-bold hover:bg-amber-300">🎯 Completar Desafío</button>
            </div>
          `;
        }

        card.innerHTML = `
          <h3 class="text-xl font-bold mb-2 text-white">${module.title}</h3>
          <p class="text-sm text-gray-400 mb-4">${module.description}</p>
          <div class="flex items-center justify-between text-sm font-semibold mb-4 border-t border-b border-gray-700 py-2">
            <span class="text-gray-400">⭐ Recompensa:</span>
            <span class="text-amber-400 font-extrabold">+${module.coin_reward} Delta Coins</span>
          </div>
          ${actionsHTML}
        `;
        modulesEl.appendChild(card);
      });
    }

    /* ---------- Inicialización ---------- */
    renderModules();
    updatePhase();

    // Exponer funciones al global para que los onlick inline funcionen
    window.startDownload = startDownload;
    window.completeMission = completeMission;
  </script>
</body>
</html>
